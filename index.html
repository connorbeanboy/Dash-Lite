<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dash Lite</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #87CEEB; /* Sky Blue */
        }

        canvas {
            display: block;
            margin: 0 auto;
        }

        #menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.8); /* semi-transparent white */
        }

        #menu h1 {
            font-size: 48px;
            margin-bottom: 30px;
        }

        .menu-btn {
            padding: 20px 40px;
            margin: 10px;
            background: black;
            color: white;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
        }

        .menu-btn:hover {
            background: #555;
        }

    </style>
</head>
<body>
    <div id="menu">
        <h1>Dash Lite</h1>
        <div class="menu-btn" onclick="startPlay()">Play</div>
        <div class="menu-btn" onclick="startEditor()">Editor</div>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const menu = document.getElementById("menu");

        // === STATE ===
        let state = "menu"; // "menu", "play", "editor"
        let gameMode = "cube"; // "cube", "ship", "ufo", "wave"
        let holding = false;
        let scrollSpeed = 5;
        let gravity = 0.8;

        // === PLAYER ===
        const player = {
            x: 100,
            y: 300,
            size: 40,
            vy: 0,
            waveDir: -1
        };

        // === LEVEL ===
        let objects = [];
        let selected = "spike";

        // === INPUT ===
        document.addEventListener("keydown", (e) => {
            if (e.code === "Space") holding = true;

            if (state === "menu") {
                if (e.key.toLowerCase() === "p") startPlay();
                if (e.key.toLowerCase() === "e") startEditor();
            }

            if (state === "editor") {
                if (e.key === "1") selected = "spike";
                if (e.key === "2") selected = "block";
                if (e.key === "3") selected = "cube";
                if (e.key === "4") selected = "ship";
                if (e.key === "5") selected = "ufo";
                if (e.key === "6") selected = "wave";
                if (e.key === "s") saveLevel();
                if (e.key === "l") loadLevel();
                if (e.key === "p") startPlay();
            }

            if (e.key === "Escape") {
                state = "menu";
                menu.style.display = "flex";
            }
        });

        document.addEventListener("keyup", (e) => {
            if (e.code === "Space") holding = false;
        });

        canvas.addEventListener("mousedown", (e) => {
            if (state !== "editor") return;
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / 40) * 40;
            const y = Math.floor((e.clientY - rect.top) / 40) * 40;
            objects.push({ type: selected, x, y });
        });

        // === LEVEL MANAGEMENT ===
        function saveLevel() {
            localStorage.setItem("dashLite", JSON.stringify(objects));
        }

        function loadLevel() {
            const data = localStorage.getItem("dashLite");
            if (data) objects = JSON.parse(data);
        }

        // === GAME LOOP ===
        function update() {
            if (state !== "play") return;

            // Physics for player movement
            player.vy += gravity;
            if (holding && player.y >= 300) player.vy = -14; // Jumping

            player.y += player.vy;

            // Check collision with floor
            if (player.y + player.size > canvas.height) player.y = canvas.height - player.size;

            // Check collisions with objects
            objects.forEach((o, index) => {
                o.x -= scrollSpeed;

                if (o.type === "spike" && hit(player, o)) die();
                if (o.type === "block" && hit(player, o)) die();

                if (["cube", "ship", "ufo", "wave"].includes(o.type) && hit(player, o)) {
                    gameMode = o.type;
                    objects.splice(index, 1); // Remove portal
                }

                if (o.x + 40 < 0) objects.splice(index, 1); // Remove off-screen objects
            });
        }

        function hit(a, b) {
            return a.x < b.x + 40 && a.x + a.size > b.x && a.y < b.y + 40 && a.y + a.size > b.y;
        }

        function die() {
            state = "menu";
            menu.style.display = "flex";
        }

        // === DRAWING ===
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (state === "menu") {
                ctx.fillStyle = "black";
                ctx.font = "40px Arial";
                ctx.fillText("Dash Lite", 300, 180);
                ctx.font = "20px Arial";
                ctx.fillText("P = Play | E = Editor", 270, 220);
                return;
            }

            // Draw player
            ctx.fillStyle =
                gameMode === "cube" ? "red" :
                gameMode === "ship" ? "green" :
                gameMode === "ufo" ? "blue" : "purple";
            ctx.fillRect(player.x, player.y, player.size, player.size);

            // Draw objects (spikes, blocks, portals)
            objects.forEach((o) => {
                if (o.type === "spike") {
                    ctx.fillStyle = "black";
                    ctx.beginPath();
                    ctx.moveTo(o.x, o.y + 40);
                    ctx.lineTo(o.x + 20, o.y);
                    ctx.lineTo(o.x + 40, o.y + 40);
                    ctx.fill();
                } else if (o.type === "block") {
                    ctx.fillStyle = "grey";
                    ctx.fillRect(o.x, o.y, 40, 40);
                } else if (o.type === "cube" || o.type === "ship" || o.type === "ufo" || o.type === "wave") {
                    ctx.fillStyle = "blue";
                    ctx.fillRect(o.x, o.y, 40, 40);
                }
            });
        }

        // === GAME LOOP ===
        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();

        // === FUNCTIONS ===
        function startPlay() {
            state = "play";
            menu.style.display = "none";
            player.y = 300;
            player.vy = 0;
            gameMode = "cube";
            objects = [];
        }

        function startEditor() {
            state = "editor";
            menu.style.display = "none";
            player.y = 300;
            player.vy = 0;
            gameMode = "cube";
        }
    </script>
</body>
</html>
